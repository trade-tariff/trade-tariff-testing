version: 2.1
orbs:
  cypress: cypress-io/cypress@1.27.0
  slack: circleci/slack@4.1

workflows:
  debug:
    jobs:
      - cypress/run:
          context: trade-tariff
          name: "ðŸš€ UK & XI Smoke tests"
          executor: cypress/browsers-chrome77
          browser: chrome
          store_artifacts: true
          spec: "*/**/smokeTestUKXI.spec.js"
          post-steps:
            - store_test_results:
                path: cypress/results
            - store_artifacts:
                path: cypress/reports
            - slack/notify:
                channel: tariffs-etl
                event: fail
                template: basic_fail_1
            - slack/notify:
                channel: tariffs-etl
                event: pass
                template: basic_success_1
          filters:
            branches:
              only:
                - debug-cron

  nightly:
    triggers:
      - schedule:
          cron: "0 5 * * *"
          filters:
            branches:
              only:
                - main
    jobs:
      - cypress/run:
          context: trade-tariff
          name: "ðŸš€ UK & XI Smoke tests"
          executor: cypress/browsers-chrome77
          browser: chrome
          store_artifacts: true
          spec: "*/**/smokeTestUKXI.spec.js"
          post-steps:
            - store_test_results:
                path: cypress/results
            - store_artifacts:
                path: cypress/reports
            - slack/notify:
                channel: tariffs-etl
                event: fail
                template: basic_fail_1
            - slack/notify:
                channel: tariffs-etl
                event: pass
                template: basic_success_1
